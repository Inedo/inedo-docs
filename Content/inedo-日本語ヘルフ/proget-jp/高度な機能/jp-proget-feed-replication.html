---
title: "フィードを複製（レプリケーション）"
order: 5
hidden: true
---

<p>ProGet Enterpriseは、ローカルとグローバルの両方で、複数のProGetサーバー間でフィードを複製（レプリケーション）できます。</p><p>在宅勤務とグローバル化が進むにつれ、多拠点での開発が一般的になりました。大陸をまたいだ大規模な共同作業は、バージョン管理、ネットワークアクセス、ネットワーク速度が課題になります。</p><p>これを解決するのが、ProGet のフィードレプリケーション機能です。ProGet のフィードレプリケーション機能には、以下のメリットがあります。</p><ul><li>部門間でのパッケージの共有</li><li>ネットワークの遅延や帯域幅の制限を防ぐ。</li><li>サイト固有のハードウェア障害によるアクセス制限を防ぐために、重要なサービスの可用性を維持。</li><li>時間、イベント、またはオンデマンドに基づいてレプリケーションのスケジュールを自動化。</li><li>リポジトリをローカルネットワークの外にある ProGet の別のインスタンスに複製。</li><li>世界のどこにいても、異なるチームがパッケージを利用できるようにする。</li></ul><p>マルチサイトレプリケーションを実行するには、フィードを、レプリケーションサーバとレプリケーションクライアントとして設定します。</p><h2>フィードレプリケーションの設定方法</h2><p>フィードレプリケーションは、[Feed Management (フィード管理)] ページでフィードごとに構成され、フィードの管理権限が必要です。 フィードは、レプリケーションサーバー、レプリケーションクライアント、またはより高度なシナリオの両方として構成できます。</p><h3>ソースURL：</h3><p>ソースURLはレプリケーションサーバに公開されたエンドポイントであり、レプリケーションクライアントの設定内で指定する必要があります。</p><h3>同期トークン：</h3><p>フィードをレプリケーションサーバーとして構成するには、同期トークンを追加/生成する必要があります。同期トークンは、レプリケーションクライアントがレプリケーションサーバーのURLとともに提供する必要があります。 同期トークンは、レプリケーションクライアントがフィードに接続できるようにするため、機密情報として扱う必要があります。</p><h3>レプリケーションクライアント</h3><p>レプリケーションクライアントとは、他のProGetインスタンス内のレプリケーションサーバフィードへ接続できるように設定された ProGet フィードです。レプリケーションクライアントフィードには以下の機能があります。</p><ul><li>プル - ローカルフィードが、レプリケーションサーバフィードから（新しくプッシュされたパッケージや削除されたパッケージなどの）変更情報を読み込む</li><li>プッシュ - ローカルフィードが、レプリケーションサーバフィードに対して変更情報を送信する</li><li>ミラー - ローカルフィードが、レプリケーションサーバフィードに対してプッシュとプルの両方を行う</li></ul><h2>レプリケーションサーバ</h2><p>レプリケーションサーバとは、レプリケーションクライアントの接続とフィードステートでのレスポンスを許可する ProGet のフィードです。レプリケーションクライアントがフィードステートをプロセスすると、設定によって、パッケージのダウンロードやインストール、削除などができます。</p><h3>オプション：</h3><ul><li>[Disabled (無効化)] -&nbsp;レプリケーションクライアントはフィードに接続できない</li></ul><ul <li="" class="bulleted-list" id="898746f2-046f-4f69-a22a-4baad011a2e4"><li>[Allow external feeds to replicate from this feed (read-only) (外部のフィードからこのフィードの複製を許可する) (閲覧のみ)] -&nbsp;レプリケーションクライアントはフィードへの接続と変更のプルができるが、変更をプッシュすることはできない</li></ul><ul><li>[Allow local feeds to be changed by external feeds (read/write) (外部のフィードからローカルフィードの変更を許可する) (閲覧/編集)] -&nbsp;レプリケーションクライアントはフィードへの接続や変更のプル、変更のプッシュを行うことができる</li></ul><p id="5d79c911-c2bd-4563-b32f-dc64226f4ae4">注釈：ProGetv.5.2 以前のバージョンでのレプリケーションサーバの設定は [Allow other feeds to replicate with this one (別のフィードからのこのフィードの複製を許可する)] から行ってください。</p><h3 id="ad276802-271b-458c-bdfe-3676def31b64">有効な構成</h3><p id="c9b6a5c8-cefc-4973-91dd-b2e675d70651">以下の表は有効な構成の詳細です。（列がクライアント構成、行がサーバ構成）</p><table style="width: 100%;"><thead><tr><th><br></th><th>無効化</th><th>プルのみ</th><th>プッシュのみ</th><th>ミラー</th></tr></thead><tbody><tr><td style="width: 20.0000%;">無効</td><td style="width: 20.0000%;">-</td><td style="width: 20.0000%;">無効</td><td style="width: 20.0000%;">無効</td><td style="width: 20.0000%;">無効</td></tr><tr><td style="width: 20.0000%;">閲覧のみ</td><td style="width: 20.0000%;">-</td><td style="width: 20.0000%;">有効</td><td style="width: 20.0000%;">無効</td><td style="width: 20.0000%;">注意</td></tr><tr><td style="width: 20.0000%;">閲覧/書き込み</td><td style="width: 20.0000%;">-</td><td style="width: 20.0000%;">有効</td><td style="width: 20.0000%;">有効</td><td style="width: 20.0000%;">有効</td></tr></tbody></table><p>無効な構成は、クライアントと [Diagnostic Center (診断センター)] によってそれぞれの実行ログに記録されます。</p><h1 id="9968e4b5-436b-44e9-b9d3-4f7af94e0bb6">アーキテクチャの例</h1><h2 id="ed3d7b2b-7a8f-4641-9fe5-eec6292fe158">フルレプリケーションとミラーリング</h2><p id="55096590-37c1-4ffb-8c14-33dd68743e1b">単純な例としては、複数の ProGet インストレーションに対して単一のフィードを完全にミラーリングする方法があります。以下の例では、ロサンゼルスが「ハブ」として設定され、東京とクリーブランドの両方がロサンゼルスのフィードをレプリケーション（複製）するように構成されています。</p><div class="collection-content" id="553eac51-a600-4f72-b1fa-baf67fcdf8f6"><h4><br></h4><table><thead <tr=""><tr><th>位置</th><th>クライアント</th><th>サーバ</th></tr></thead><tbody <tr=""><tr><td>Tokyo</td><td>[Mirror external feed (Los Angeles) &nbsp;(外部フィードをミラーリングする) &nbsp;(ロサンゼルス)]</td><td>[Disabled (無効化)]</td></tr><tr><td>Los Angeles</td><td class="cell-pbh`">[Disabled (無効化)]</td><td class="cell-v^_M">[Allow local feeds to be changed by external feeds (外部フィードによるローカルフィードの変更を許可する)]</td></tr><tr><td>Cleveland</td><td>[Mirror external feed (Los Angeles) (外部フィードをミラーリングする) (ロサンゼルス)]</td><td>[Disabled (無効化)]</td></tr></tbody></table></div><p>この設定を完了させるには、それぞれの都市を以下のように構成してください：</p><p>この設定は、3 つのインストレーション内のパッケージプッシュや削除の情報を他のインストレーション全てにプロパゲーションします。</p><p>この構成を行うには、本番環境に対応するために 3 つのProGetエンタープライズライセンスが必要です。また、インスタンスをテストするためには追加のライセンスが必要です。さらに詳しい高可用性テスト環境の利点については、無料版のProGetからProGetエンタープライズへの移行についてのブログ（リンク先英語）をご覧ください。</p><h2 id="d409a48e-f145-4545-b2e1-db742b668d47">パーシャルレプリケーション</h2><p id="a8c26f5a-3ed6-418a-867b-7f8fe6794e2e">さらに複雑な例では、インストレーションがレプリケーションクライアントとサーバの両方として機能するように設定する方法があります。</p><p id="dfac31ef-ab59-4baa-a916-017e303e0232">以下の例では、ニューヨークが世界中にある複数のProGetサーバのハブとして機能しています。ニューヨークはロサンゼルスのフィードを完全にミラーリングするように設定されていますが、東京、マイアミ、ベルリンにあるProGetインストレーションはニューヨークからの変更をプルするようにのみ設定されています。このように設定すれば、東京、マイアミ、ベルリンの変更がニューヨークやロサンゼルスに適応されるのを防げます。</p><p id="31e6e643-7ca5-44ff-a8aa-c428a5cc7712">この設定を完了させるには、それぞれの都市を以下のように構成してください：</p><div class="collection-content" id="ee7e9001-77b3-4627-955e-5fb90c21d86a"><h4><br></h4><table><thead><tr><th>位置</th><th>クライアント</th><th>サーバ</th></tr></thead><tbody <tr=""><tr><td>Los Angeles</td><td>[Disabled (無効化)]</td><td>[Allow local feeds to be changed by external feeds (外部フィードによるローカルフィードの変更を許可する)]</td></tr><tr><td>New York</td><td>[Mirror external feed (Los Angeles) (外部フィードをミラーリングする) (ロサンゼルス)]</td><td>[Allow external feeds to replicate from this feed (外部フィードのこのフィードからのレプリケーションを許可する)]</td></tr><tr><td>Tokyo</td><td>[Only apply external changes to local feed (New York) (外部の変更のみをローカルフィードに適用する) (ニューヨーク)]</td><td>[Disabled (無効化)]</td></tr><tr><td>Miami</td><td>[Only apply external changes to local feed (New York) (外部の変更のみをローカルフィードに適用する) (ニューヨーク)]</td><td>[Disabled (無効化)]</td></tr><tr><td>Berlin</td><td>[Only apply external changes to local feed (New York) (外部の変更のみをローカルフィードに適用する) (ニューヨーク)]</td><td>[Disabled (無効化)]</td></tr></tbody></table></div><p>上記の構成は以下の動作を起こします：</p><ul><li>ロサンゼルスとニューヨークのフィードは完全にミラーリングされ、プッシュや削除情報はお互いにプロパゲーションされる</li><li>東京、マイアミ、ベルリンのフィードはニューヨーク（または拡張によってロサンゼルス）からのプッシュや削除情報を定期的にプルする</li><li>東京、マイアミ、ベルリンのフィードに対してのプッシュや削除はニューヨーク（または拡張によってロサンゼルス）に適用されない</li><li>ニューヨークで削除された特定のパッケージは、パッケージの種類・名前・バージョンが一致していれば（もともと東京やマイアミ、ベルリンで作成されたものでなくても）東京、マイアミ、ベルリンでも削除される</li></ul><p id="05adf35a-8b53-478d-935d-e18bbda2c93e">この構成を行うには、本番環境に対応する 5 つのProGetエンタープライズライセンスが必要です。また、インスタンスをテストするためには追加のライセンスが必要です。さらに詳しい高可用性テスト環境の利点については無料版のProGetからProGetエンタープライズへの移行についてのブログ記事（リンク先英語）をご覧ください。</p><h1 id="e7b91a16-3b2e-4ce8-b5b7-7ad483bc1d78">ベストプラクティス</h1><p id="d1ff21d3-af03-496c-b4b0-98801d6f1f7d">過去のお問い合わせ内容に基づき、以下のガイドラインをおすすめしています：</p><ul><li>◯：レプリケーションに関わる全てのProGetインストレーションが全く同じProGetのバージョン（最低限、同じマイナーバージョン（例：5.5.x））で稼働していること</li><li>◯：可能であれば読み取り専用のレプリケーションではなく、外部フィード用<a href="/docs/inedo-日本語ヘルフ/proget-jp/フィートリホシトリの作成と管理/jp-proget-connector-overview" rel="noopener noreferrer" target="_blank" translate="no">コネクタ</a>の使用</li><li>✕：ProGetの同じインスタンス内で、別フィードのレプリケーション　を設定する</li><li>✕： レプリケーションクライアントとサーバーがお互いを指定するようなインスタンスを2つ構成する</li><li>✕：独自レプリケーションを提供するパッケージストアをすでに利用しており、さらに可用性を目的としてレプリケーションを使用すること。例）地域をまたいだレプリケーションを提供している<a href="/docs/inedo-日本語ヘルフ/proget-jp/高度な機能/jp-proget-cloud-storage" translate="no">AWSパッケージストア</a>を利用している場合など</li><li>✕：レプリケーションサーバを「このフィードがローカルフィードによって変更されることを許可する」ように設定し、信頼されていないパーティに同期トークンを配布の上、フィード内容（感染したパッケージやマルウェアなどを含む可能性がある）へのフルアクセスを有効にすること</li></ul><h1 id="35a5dd10-9c7b-48f8-94a8-9f3dc76a60b5">トラブルシューティング</h1><p id="d319adf9-9966-491e-9003-0ad5521db8dc">レプリケーション関連のエラー要因で最も多いのが、レプリケーションに関わるサーバクラスタのそれぞれに ProGet エンタープライズ（もしくは体験版）が必要という条件を満たしていないことです。この場合、エラーが生成され、レプリケーションは実行されません。</p><h2 id="98ac25d1-3d2e-4cbe-bdcb-9e0b36f557d9">レプリケーションステータス・概要</h2><p>レプリケーションが構成されたフィードの一覧は、[Administration (管理)] ＞ [Replication Overview (レプリケーション概要)] からご覧ください。</p><h2>ロッジング</h2><p>レプリケーションクライアントのログは [Executions (実行)] ページから見られます。 &nbsp;[Administration (管理)] ＞[Executions (実行)] に移動し、[Feed Replication (フィードレプリケーション)] のフィルタをかけて表示してください。</p><h3>サーバ</h3><p>レプリケーションサーバのログは [Diagnostic Center (診断センター)] から閲覧できます。[Administration (管理)] ＞ [Diagnostic Center (診断センター)] ＞ [View Log Messages (ログメッセージを閲覧する)] から、[Feed Replication (フィードレプリケーション)] のフィルタをかけると、エラーメッセージがある場合は表示されます。</p><p>デフォルトの設定では、レプリケーションサーバのエラーのみが記録されるのでご注意ください。成功した接続の記録を有効にするには、[Advanced Settings (詳細設定)] のページに移動し、Diagnostics.MinimumLogLevel を 0 に設定してください。こうすると、デバッグメッセージが有効になります。 また、設定を反映させるにはウェブアプリケーションを再起動する必要があります。0 に設定するのは一時的にし、その後デフォルトの値である20に戻すことをおすすめしています。</p><h2>クライアントとサーバのオプションがない場合</h2><p>レプリケーションクライアント/サーバの区別は ProGet v5.2 から加わった要素であり、 それ以前のバージョンはどちらか片方しか構成できません。Replicate from external feed (外部のフィードからレプリケーションする)と [allow other feeds to replicate with this one (他のフィードがこのフィードをレプリケーションすることを許可する)] のオプションが、クライアントとサーバそれぞれと同じ役割を果たしています。</p><h2>Docker</h2><p>DockerフィードレプリケーションはProGet&nbsp;5.2.5以降から対応しており、</p><ul><li>公開の日付とダウンロード数は同期されない</li><li>blobとマニフェストは全て同期されるので、リテンションのルールはそれぞれの同期から設定する必要がある</li><li>削除記録（墓石を意味するtumbstoneと呼ばれることもある）は Docker フィードに記録されないので、イメージはフィードレプリケーションでしか追加できず、消去することはできない。タグがないイメージを削除するには、リテンションのルールを設定する必要がある</li></ul>
