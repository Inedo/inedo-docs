---
title: "アクセス権の管理とセキュリティ"
order: 4
hidden: true
---

<p id="bb7fffef-91fe-4db8-bc73-486c9d371a21">リテンションルールを使用すると、ディスク空き容量の再利用が楽になります。これは、定義した一連の基準を満たす古いパッケージまたは未使用のパッケージの削除を自動的に行える一方で、このルールから除外するパッケージも指定できるからです。</p><p id="e57e5df4-0284-4eed-93f5-069585792d87">フィードのリテンションを使用するには、今のところ ProGet のベーシックライセンスまたはエンタープライズライセンスが必要です。ProGet 無料版でもルールを構成することはできますが、無料版では常に <a href="/docs/proget/administration/retention-rules#dry-run-mode">dry run mode (ドライランモード)</a> で実行されます。</p><h2 id="0a4d58b6-9198-4683-9561-a31084b10145">リテンションルールの作成</h2><p id="78cae4b5-4ebb-41c4-aaf7-0be5878af98c">リテンションルールは、[Manage Feed (フィードの管理)] ページに移動し、[Storage &amp; retention (ストレージとリテンション)] タブに移動して、削除するパッケージを記述することにより、フィードごとに構成されます。</p><p id="2d7c123b-6109-4871-b835-934ee3ce0925">ルールは、フィードタイプに基づいて、次のオプションで構成されています。ルールで複数のオプションが選択されている場合、アクションが評価されるのは選択されたすべての基準を満たすパッケージのみとなります。詳細については、<a href="/docs/proget/administration/retention-rules#matching">matching examples (一致する例)</a> を参照してください。</p><p id="8d157523-9c83-4f23-83ba-bc1c2761fdea">フィードには複数のルールを適用できます。この場合、ルールは ProGet UI 上で表示される順番 (上から下) で実行されます。しかし、<a href="/docs/proget/administration/retention-rules#Quotas">クォータ</a>が使用されている場合、クォータ条件が満たされた後でも、すべてのルールが実行されるとは限りません。</p><h3 id="ff387961-b209-450f-b594-627afda6b94f"><strong>パッケージのルール</strong></h3><div id="0d22cf7c-a4af-4afb-9f24-02d84cb38f46"><table><thead><tr><th>アクション</th><th>結果</th></tr></thead><tbody><tr id="511f8ea1-8317-4812-b84e-583d11802fa8"><td class="cell-title">Delete cached connector packages (キャッシュされたコネクタパッケージを削除する)</td><td class="cell-V@jz">コネクタからキャッシュされたパッケージが削除の対象となります</td></tr><tr id="16144d59-ea03-4477-977d-523b8cca7785"><td class="cell-title">Delete prerelease versions (プレリリースバージョンを削除する)</td><td class="cell-V@jz">「プレリリース」バージョン (4.1.0-beta など) のパッケージが削除されます</td></tr><tr id="eaac2a4d-efbf-425e-924a-7e83edc09a7c"><td class="cell-title">Delete old versions (古いバージョンを削除する)</td><td class="cell-V@jz">パッケージの最新の指定したバージョン (N) を除くすべてが削除されます</td></tr><tr id="691803c6-7aee-4aa5-a411-3fc943fac041"><td class="cell-title">Delete unused versions (未使用のバージョンを削除する)</td><td class="cell-V@jz">過去の指定した期間 (N) で、ダウンロード数が指定した数 (Y) 未満なものを除くすべてのパッケージが削除されます</td></tr><tr id="d0c6cb42-481c-45d8-8c78-020c72568588"><td class="cell-title">Delete/keep by package name (パッケージ名で削除 / 保持)</td><td class="cell-V@jz">指定された名前のパッケージが削除されるか、保持されます。このフィールドでは<a href="/docs/proget/administration/retention-rules#wildcards">ワイルドカード</a>がサポートされています</td></tr><tr id="f24989e8-0a7c-4fd2-b1be-a63f16289e4b"><td class="cell-title">Delete/keep by package version (パッケージバージョンで削除 / 保持)</td><td class="cell-V@jz">指定されたバージョンのパッケージが削除されるか、保持されます。このフィールドでは<a href="/docs/proget/administration/retention-rules#wildcards">ワイルドカード</a>がサポートされています</td></tr><tr id="b4a28e37-8bec-40a5-ad8e-34fae549c66f"><td class="cell-title">Delete/keep consumed packages (使用されたパッケージを削除 / 保持)</td><td class="cell-V@jz">他のパッケージで使用されたパッケージが、他のフィードで使用されていない場合は削除できます。他のフィードのパッケージで使用されている場合は削除できません</td></tr></tbody></table></div><h3 id="17eaec2a-f433-4cd7-95f0-849434ad0484"><strong>コンテナのルール</strong></h3><div id="8478da91-3967-489d-89b4-9ed550c8920e"><h4><br></h4><table><thead><tr><th>アクション</th><th>結果</th></tr></thead><tbody><tr id="f5f6d79e-09a1-4dde-ab33-7461f3914d83"><td class="cell-title">Delete cached connector packages (キャッシュされたコネクタパッケージを削除する)</td><td class="cell-\Rjj">コネクタからキャッシュされた画像が削除の対象となります</td></tr><tr id="0f778afb-864e-42a8-b54a-12a941a2f74c"><td>Delete untagged manifests (タグのないマニフェストを削除する)</td><td>タグが関連付けられていないマニフェストが削除の対象となります</td></tr><tr><td>Delete unused versions (未使用のバージョンを削除する)</td><td>過去の指定した期間 (N) で、ダウンロード数が指定した数 (Y) 未満なものを除くすべての画像が削除されます</td></tr><tr><td>Delete/keep by repository name (リポジトリ名で削除 / リテンション)</td><td>指定された名前の画像が削除されるか、保持されます。このフィールドでは<a href="/docs/proget/administration/retention-rules#wildcards">ワイルドカード</a>がサポートされています</td></tr><tr id="5a98332b-83bf-4fa2-887f-e97e15a07abd"><td class="cell-title">Delete/keep by image tag (画像タグによる削除 / 保持)</td><td class="cell-\Rjj">指定されたタグの画像が削除されるか、保持されます。このフィールドでは<a href="/docs/proget/administration/retention-rules#wildcards">ワイルドカード</a>がサポートされています</td></tr><tr id="09d35596-7f51-4222-9962-9467d2875549"><td class="cell-title">Delete when all package usage removed (すべてのパッケージが使用されなくなったら削除)</td><td class="cell-\Rjj"><a href="/docs/proget/docker/container-scanners">コンテナが使用した期間 (N) 使用されなかった</a> 場合、画像が削除されます</td></tr></tbody></table></div><p id="6407b431-cef9-413f-963f-3aba58c7a0d2">タグのない画像とタグの付いた画像は、同じリテンションルールで削除できません。</p><h3 id="c1de6b53-5126-4f1e-9824-7104299cc2a1"><strong>アセットのルール</strong></h3><div id="ae701b3b-d2a3-4e10-94fa-c082f06d2fab"><h4><br></h4><table><thead><tr><th>アクション</th><th>結果</th></tr></thead><tbody><tr id="ad3c4e61-c4dc-48c7-b98d-870000cc95bc"><td class="cell-title">Delete unused files (未使用のファイルを削除する)</td><td class="cell-~^dJ">過去の指定した期間 (N) で、ダウンロード数が指定した数 (Y) 未満なものを除くすべてのファイルが削除されます</td></tr><tr id="a3a09593-448a-4730-9da2-ade222828327"><td class="cell-title">Delete/keep by file name (ファイル名で削除 / リテンション)</td><td class="cell-~^dJ">指定された名前のファイルが削除されるか、保持されます。このフィールドでは<a href="/docs/proget/administration/retention-rules#wildcards">ワイルドカード</a>がサポートされています</td></tr></tbody></table></div><h3 id="c92bd17c-3b90-4fc6-ba48-41ce647b0e99"><strong>ワイルドカード</strong></h3><p id="13aaac2d-4312-4895-b08b-b39317bb9f1d">上記の特定のフィールドでは、ワイルドカード構文がサポートされています。名前またはバージョンを指定する際にアスタリスク (*) を使用すると、0 文字以上に一致します。</p><p id="79cf9ea2-2734-4eb0-84a6-09c1147674ef">たとえば、一致する ID を持つパッケージを保持したい場合は、次のように構成します。</p><p id="51036cee-ea7d-4802-b00f-081055f7762e">Microsoft.*</p><p id="f18fb08a-2b91-401a-a6f9-ff5449cbe596">Castle.*</p><p id="63dc7279-e4eb-40af-b5ce-69adb623c5de">こうすると、リテンションルールを実行した際、ID が Microsoft. または Castle. で始まるすべてのパッケージが保持されます。</p><h2 id="183116b9-b1f5-40f2-b0ab-cc9aeec4eaac">クォータ</h2><p id="dd1d437c-7a32-4b9f-8376-2aa18b5e0064">特定のサイズのしきい値に達したときにのみ実行されるルールも定義できます。</p><p id="1d720fb4-f227-4d72-ac9c-133d8bb60597">ルールに使用できるクォータ構成は、次の 3 つです。</p><div id="4518f1fc-6609-4f31-b7cd-1dab0f87cc12"><h4><br></h4><table><thead><tr><th>構成</th><th>結果</th></tr></thead><tbody><tr id="c04a6c70-672f-400a-873b-53955390657e"><td class="cell-title">none (なし)</td><td class="cell-zoGY">クォータが定義されていない状態です。ルールのフィルタに一致するすべてのパッケージが常に削除されます。</td></tr><tr id="e8aa7bb6-cf82-4d41-8df8-87c8e454400b"><td class="cell-title">size of matching packages (一致するパッケージのサイズ)</td><td class="cell-zoGY">ルールのフィルタに一致するすべてのパッケージの合計サイズに対して、ユーザー指定のサイズが適用されます。このルールでは、一致したパッケージの残りが指定されたサイズ以下のディスク空き容量を消費するまで、パッケージが削除されます。</td></tr><tr id="824ca471-a728-417b-a22f-e81ee35baf75"><td class="cell-title">size of entire feed (フィード全体のサイズ)</td><td class="cell-zoGY">フィードにあるすべてのパッケージの合計サイズに対して、ユーザー指定のサイズが適用されます。これは、ルールのフィルタに一致しないパッケージであったとしても適用されます。このルールでは、一致するパッケージのみが削除されます。これは、フィード全体のサイズが指定されたサイズ以下になるまで行われます。</td></tr></tbody></table></div><p id="0cd23780-96dd-44ad-b8e7-8a98d9bd78c2">クォータが定義されている場合、ProGet によって指定されたサイズになるまで一致するパッケージのみが削除されます。</p><p id="893e4b47-0715-4eac-882e-c544de2de70d">パッケージ削除の優先順位は、次の通りです。</p><ol><li>キャッシュされたパッケージが常に最初に削除されます。</li><li>キャッシュされたパッケージがなくなった場合は、次にプレリリースパッケージが削除されます。</li><li>キャッシュされたパッケージとプレリリースパッケージがなくなった場合は、一致するパッケージの以前のバージョンが削除されます。</li><li>その他すべてのパッケージが順不同で削除されます。</li></ol><p id="d65e1865-d57f-4148-9445-9e326907c104">この削除の優先順位は便宜上実装されているだけなので、<strong>必ずしもパッケージの削除を防げるわけではありません</strong>。パッケージがリテンションされないようにしたい場合は、<strong>そもそもルールと一致しないようにしてください。</strong></p><h2 id="e8efdfb8-b214-4c85-91a3-f19ac5310881">ドライランモード</h2><p id="e4394cab-26ec-4ed5-a6b1-5f0bda3a3579">[Admin (管理)] &gt; [Advanced Settings (詳細設定)] ページには、 <strong>FeedRetentionDryRun&nbsp;</strong>オプションがあります。このオプションを選択すると、ProGet のリテンションルールによって実際に何かが削除されるのを防げます。つまり、これが有効な場合、通常通りルールが実行されパッケージがログに記録される一方で、ドライランモードが無効になっている状態なら削除されてしまうパッケージが、実際には削除されずスキップされます。</p><p id="00ded14d-8eb3-4a73-a51d-9610dfe7be38">この機能は、ライブフィードで実行する前にルールが正しいかどうかを評価したい場合に役立ちます。<strong>FeedRetentionDryRun&nbsp;</strong>オプションを設定した後にドライランをトリガーするには、[Admin (管理)] セクションに移動して [Scheduled Jobs (スケジュールされたジョブ)] を選択します。すると、スケジュールされたタスクのリストが表示され、その横に緑色の再生ボタンが表示されます。実行するリテンションルールを選択して再生ボタンをクリックすると、そのルールの影響を受けるパッケージのログが表示されます。</p><p id="f6cadee2-508b-4672-8629-bf398a089748">しかし、テストおよびドライランモードは、パッケージリポジトリの適切なバックアップの代用を目的としては開発されていません。リテンションによってパッケージを削除すると、<strong>元に戻すことはできません。</strong>そのため、本番環境では、トラブル発生に備えて定期的なリポジトリのバックアップを行うようにしてください。</p><h2 id="6e389591-6f32-4e9d-b173-d2d9dfb325b1">リテンションルールのマッチング例</h2><p id="ad141aec-4327-4a70-8a9e-989d2c507c61">ProGet のリテンションルールは強力なため、多くのユースケースを処理できます。以下では、いくつかの一般的なシナリオとそれらを構成する方法を説明します。</p><h3 id="9d1ef90f-c8d5-48a0-b57e-d27f6dbd2ec2"><strong>30 日以内にダウンロードされなかった、キャッシュされたパッケージを削除する</strong></h3><p id="6ba1f1c8-c6ed-4d96-b27b-cdc9686423d0">ルールが評価されてから 30 日以内で、誰からも要求がなかったコネクタからキャッシュされたすべてのパッケージが削除されます。</p><ul><li>☑<strong>キャッシュされたコネクタパッケージを削除する</strong></li><li>☑<strong>未使用のバージョンを削除し</strong>、<strong>30&nbsp;</strong>日間出力する</li></ul><h3 id="da84e10d-51a0-4720-aaf3-6793b5831346"><strong>以前のプレリリースバージョンを削除する</strong></h3><p id="f1372505-244f-47e1-b4fb-ce6162b29bc4">最新のプレリリースバージョン以外の、すべてのパッケージの すべてのプレリリースバージョンが削除されます。</p><ul><li>☑<strong>プレリリースバージョンを削除する</strong></li><li>☑<strong>古いバージョンが削除され</strong>、最新バージョンのみが残る</li></ul><h3 id="531ace04-3ebd-4fda-a9a9-077e911993c4"><strong>特定のパッケージの古いバージョンを削除する</strong></h3><p id="1ccd5e9d-4200-438e-ae89-de6de3e99b1f">ワイルドカードフィルタ <strong>my.package</strong>.* に一致するパッケージで、最新から 5 つのバージョン以外のすべてが削除されます。</p><ul><li>☑<strong>古いバージョンが削除され</strong>、最新から 5 つ目までのバージョンが残る</li><li>☑<strong>パッケージ名で削除</strong><strong>&nbsp;/&nbsp;</strong><strong>保持され</strong>、<strong>ID&nbsp;</strong><strong>値が一致する削除パッケージ</strong>として <strong>package</strong>.* が出力される</li></ul><h3 id="e6034dc8-bf8a-47a1-aaa4-beeef2b4dfdd"><strong>未使用の CI パッケージバージョンを削除する</strong></h3><p id="b6eae95d-80b3-4cad-a5f5-589eef503035">プレリリースバージョンコンポーネントに「CI」が含まれ、2 日間ダウンロードされていないすべてのパッケージバージョンが削除されます。</p><ul><li>☑<strong>プレリリースバージョンを削除する</strong></li><li>☑<strong>未使用のバージョンが削除され</strong>、<strong>2&nbsp;</strong>日間提供される</li><li>☑<strong>パッケージのバージョン</strong>ごとに<strong>削除</strong><strong>&nbsp;/&nbsp;</strong><strong>保持され、バージョン値の一致する削除パッケージが</strong> *-CI.* として出力される</li></ul><p id="3eb6ca88-f4f0-4e7c-9344-d834e61c1fa1">注：[delete prerelease versions (プレリリースバージョンを削除する)] オプションをチェックし、プレリリースバージョンにのみ一致するワイルドカードパターンを指定するのは冗長的といえますが、ポリシーでできるだけ明確にすることをおすすめします。</p><p id="0db7677f-f52e-4058-9721-bead3e7904a0"><strong>API</strong></p><p id="4e8080b9-52bc-4218-99a9-1774606e6f0f">リテンションルールは、<a href="/docs/proget/reference-api/feeds/proget-api-feeds">Feed Management API (フィード管理 API)</a> でも構成できます。詳細については、<a href="/docs/proget/reference-api/feeds/proget-api-feeds#retention-rule-object">Retention Rule data model specification (リテンションルールのデータモデルの仕様)</a> を参照してください。</p>
